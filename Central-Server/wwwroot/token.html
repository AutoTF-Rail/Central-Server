<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Fetching Token...</title>
</head>
<body>
<h1>Fetching Token...</h1>
<script>
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    (async function() {
        if ('cookieStore' in window) {
            try {
                const csrfCookie = await cookieStore.get('authentik_csrf');
                const csrfToken = csrfCookie ? csrfCookie.value : null;

                if (csrfToken) {
                    await sleep(1500);
                    window.location.href = `/tokenStep?csrf_token=${encodeURIComponent(csrfToken)}`;
                } else {
                    console.error('CSRF token not found.');
                }
            } catch (err) {
                console.error('Error fetching the CSRF token:', err);
            }
        } else {
            console.error('cookieStore API is not supported in this browser.');
        }
    })();
</script>
</body>
</html>
