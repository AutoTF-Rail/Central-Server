<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Fetching Token...</title>
</head>
<body>
<h1>Fetching Token...</h1>
<script>
    (async function() {
        let csrfToken = null;
        let proxyToken = null;
        let proxyTokenName = null;
        
        if ('cookieStore' in window) {
            try {
                const csrfCookie = await cookieStore.get('authentik_csrf');
                csrfToken = csrfCookie ? csrfCookie.value : null;

                const allCookies = await cookieStore.getAll();
                for (const cookie of allCookies) {
                    if (cookie.name.startsWith('authentik_proxy')) {
                        proxyTokenName = cookie.name;
                        proxyToken = cookie.value;
                        break;
                    }
                }
            } catch (err) {
                console.error('Error fetching tokens from cookieStore:', err);
            }
        }
        
        if (csrfToken && proxyToken) {
            window.location.href = `http://127.0.0.1:5000/token?csrf_token=${encodeURIComponent(csrfToken)}&${encodeURIComponent(proxyTokenName)}=${encodeURIComponent(proxyToken)}`;
        } else {
            console.error('Required tokens not found.');
        }
    })();
</script>
</body>
</html>
